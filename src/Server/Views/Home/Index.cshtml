@Html.Partial("_Home")
@Html.Partial("_SessionPartial")
@section Scripts {
    <!-- libs -->
    <script src="~/js/libs.min.js?@ViewBag.Version"></script>
    <script>
        errl.config = errl.config || {};
        Object.assign(errl.config, {
            version: '@ViewBag.Version'
        });
    </script>

    <!-- SIGNALR auto-generated script -->
    <script src="~/signalr/hubs"></script>

    <!-- internal <script src="~/js/app.min.js"></script> -->
    <script src="~/js/app.js?@ViewBag.Version"></script>
    <script>
        window.onerror = function () {
            errl.log(arguments);
        };

        if (!hlapp.getAccessToken()) {
            // The following code looks for a fragment in the URL to get the access token which will be
            // used to call the protected Web API resource
            var fragment = hluri.getHashToken();

            if (fragment.access_token) {
                // returning with access token, restore old hash, or at least hide token
                window.location.hash = fragment.state || '';
                hlapp.setAccessToken(fragment.access_token);
            } else {
                // no token - so bounce to Authorize endpoint in AccountController to sign in or register
                window.location = "/Account/Authorize?client_id=web&response_type=token&state=" + encodeURIComponent(window.location.hash);
            }
        }

        $(document).ready(function () {
            $.ajax({
                url: hlapp.HOST_NAME + '/api/settings',
                dataType: 'json',
                headers: {
                    'Authorization': 'Bearer ' + hlapp.getAccessToken()
                },
                success: function (data) {
                    React.render(React.createElement(HoomanLogicApp, { settings: data }), document.getElementById('hooman-logic'));
                }.bind(this),
                error: function (xhr, status, err) {
                    console.error('settings.json', status, err.toString());
                }.bind(this)
            });
        });
    </script>
}